import numpy as np
import tritonclient.grpc as grpcclient

# Triton server 地址
TRITON_GRPC = "localhost:8001"
MODEL_NAME = "gn_sjtjs_xgb_json"

client = grpcclient.InferenceServerClient(url=TRITON_GRPC)

# 构造输入数据 (batch=2, feature=514)
# 这里用随机数据，你可以换成自己的特征
batch_size = 10
feature_size = 455
input_data = np.random.rand(batch_size, feature_size).astype(np.float32)
# input_data = np.array([[0.7477042078971863, 0.6630144119262695, 0.08878389000892639, 0.07336238026618958, 0.5619525909423828, 0.8944985866546631, 0.04612695053219795, 0.8118946552276611, 0.421169638633728, 0.2818309962749481, 0.7603216171264648, 0.12831206619739532, 0.3576604723930359, 0.5991451144218445, 0.9453946948051453, 0.3918352723121643, 0.1385006457567215, 0.44911471009254456, 0.08983992040157318, 0.5437016487121582, 0.046260982751846313, 0.5518097281455994, 0.8583332896232605, 0.030161991715431213, 0.7705049514770508, 0.983540952205658, 0.27121472358703613, 0.4138970673084259, 0.6169502139091492, 0.3819393217563629, 0.7163245677947998, 0.8829373717308044, 0.26215365529060364, 0.6847195625305176, 0.9876878261566162, 0.7607505917549133, 0.8064095973968506, 0.497112512588501, 0.09048926085233688, 0.6151240468025208, 0.15755850076675415, 0.6700443029403687, 0.47235649824142456, 0.17204508185386658, 0.9097800254821777, 0.7547067999839783, 0.6609552502632141, 0.65841144323349, 0.23041746020317078, 0.4500550925731659, 0.3356158435344696, 0.054417192935943604, 0.9343805313110352, 0.5048623085021973, 0.12583279609680176, 0.5742619633674622, 0.427033394575119, 0.6506978273391724, 0.7589293718338013, 0.2930513620376587, 0.5171138644218445, 0.055650703608989716, 0.3544907867908478, 0.6968415975570679, 0.21719002723693848, 0.23205138742923737, 0.8190848231315613, 0.3111329972743988, 0.9021375179290771, 0.14885948598384857, 0.7178035378456116, 0.9994655251502991, 0.015671197324991226, 0.40051472187042236, 0.5015860795974731, 0.8912781476974487, 0.7832470536231995, 0.3260467052459717, 0.4705037772655487, 0.6257297992706299, 0.2919048070907593, 0.1381373107433319, 0.1834338754415512, 0.43543532490730286, 0.5959770679473877, 0.9155604243278503, 0.7912699580192566, 0.16878333687782288, 0.4488813579082489, 0.9388352632522583, 0.6077094078063965, 0.888808012008667, 0.3003706634044647, 0.46025165915489197, 0.9157065749168396, 0.7743070125579834, 0.7056688666343689, 0.27497100830078125, 0.22714392840862274, 0.3647715747356415, 0.7922370433807373, 0.3472272455692291, 0.0014523629797622561, 0.4509170353412628, 0.7721666097640991, 0.3037533462047577, 0.4629431664943695, 0.9777621626853943, 0.8812135457992554, 0.49285888671875, 0.6413235068321228, 0.7600894570350647, 0.7720561623573303, 0.6926599740982056, 0.008290836587548256, 0.7797592878341675, 0.030251547694206238, 0.4932176172733307, 0.017331227660179138, 0.3381669223308563, 0.5926953554153442, 0.634870707988739, 0.8402802348136902, 0.9067119359970093, 0.10321465134620667, 0.7933268547058105, 0.38643747568130493, 0.6029922366142273, 0.32898813486099243, 0.6993762254714966, 0.5605806112289429, 0.9033254981040955, 0.17023859918117523, 0.24930939078330994, 0.5818853378295898, 0.15164273977279663, 0.131534144282341, 0.1190841868519783, 0.25274351239204407, 0.4888610243797302, 0.8330605030059814, 0.9298586845397949, 0.1450739949941635, 0.4263617694377899, 0.5784795880317688, 0.7563326954841614, 0.26072341203689575, 0.8427337408065796, 0.05817582085728645, 0.4319024384021759, 0.15989850461483002, 0.7688272595405579, 0.5283644795417786, 0.5685303807258606, 0.3036069869995117, 0.6017448902130127, 0.35672667622566223, 0.7144322991371155, 0.42054805159568787, 0.645157516002655, 0.1279427707195282, 0.3848629295825958, 0.052456893026828766, 0.26759904623031616, 0.3941686153411865, 0.8121038675308228, 0.5640679001808167, 0.46367427706718445, 0.22923137247562408, 0.888627290725708, 0.2272055298089981, 0.6693369150161743, 0.1616746038198471, 0.7036020755767822, 0.9620018601417542, 0.775285005569458, 0.8053006529808044, 0.2919703423976898, 0.8291352987289429, 0.4442179799079895, 0.1906774491071701, 0.373038113117218, 0.2207394242286682, 0.6316935420036316, 0.27272316813468933, 0.19834725558757782, 0.8846965432167053, 0.8733199834823608, 0.3778925836086273, 0.15243534743785858, 0.363450288772583, 0.6111404895782471, 0.29105743765830994, 0.16134873032569885, 0.9823519587516785, 9.465603216085583e-05, 0.23525923490524292, 0.18186473846435547, 0.530147135257721, 0.8576495051383972, 0.0891881063580513, 0.25954359769821167, 0.31292620301246643, 0.8360287547111511, 0.8880710005760193, 0.7940757274627686, 0.9341410994529724, 0.7053039073944092, 0.09722433239221573, 0.13861693441867828, 0.6692526936531067, 0.37427008152008057, 0.49377089738845825, 0.6044724583625793, 0.7029613852500916, 0.012202982790768147, 0.4817642271518707, 0.80710768699646, 0.7076945304870605, 0.8819441795349121, 0.5716798901557922, 0.43196338415145874, 0.5861902236938477, 0.30321118235588074, 0.9217653274536133, 0.5217453837394714, 0.9487767219543457, 0.5195395946502686, 0.1463637799024582, 0.15557807683944702, 0.31110596656799316, 0.8377636671066284, 0.6230859160423279, 0.8322417736053467, 0.3246082067489624, 0.20221221446990967, 0.1478242129087448, 0.9150671362876892, 0.26834017038345337, 0.9431906342506409, 0.7265424728393555, 0.2465020716190338, 0.9878134727478027, 0.10847508162260056, 0.4627060890197754, 0.6315699219703674, 0.9953864216804504, 0.8182882070541382, 0.9473224878311157, 0.4140256643295288, 0.12007907032966614, 0.32698553800582886, 0.727070152759552, 0.4093596935272217, 0.12604181468486786, 0.17928016185760498, 0.7426021695137024, 0.7907448410987854, 0.4232845902442932, 0.7962551116943359, 0.8391956686973572, 0.7610437273979187, 0.22202786803245544, 0.3592946529388428, 0.9122564196586609, 0.3517262637615204, 0.017987195402383804, 0.11733705550432205, 0.09001559019088745, 0.6178829073905945, 0.3995172679424286, 0.4010803997516632, 0.7953671216964722, 0.07664134353399277, 0.5479445457458496, 0.48956847190856934, 0.08505130559206009, 0.5243520140647888, 0.4293963313102722, 0.7676349878311157, 0.006275104824453592, 0.4902637302875519, 0.46415412425994873, 0.8366538286209106, 0.9650662541389465, 0.7294309735298157, 0.30341702699661255, 0.02349834516644478, 0.33257609605789185, 0.9684959650039673, 0.22373056411743164, 0.0898100957274437, 0.7448940277099609, 0.2034463882446289, 0.8180456757545471, 0.2588428258895874, 0.050237566232681274, 0.9605592489242554, 0.24009110033512115, 0.05815693363547325, 0.9411365985870361, 0.7817086577415466, 0.06334241479635239, 0.6179282665252686, 0.41066721081733704, 0.4412899613380432, 0.271602064371109, 0.6815823912620544, 0.6490049362182617, 0.8841232657432556, 0.2870863676071167, 0.7071849703788757, 0.845186710357666, 0.9635885953903198, 0.8795768022537231, 0.03573788329958916, 0.175591379404068, 0.012088997289538383, 0.8092585802078247, 0.5721101760864258, 0.8090767860412598, 0.02536129020154476, 0.7828935384750366, 0.8763119578361511, 0.25393688678741455, 0.2656646966934204, 0.3719552457332611, 0.6664136052131653, 0.6031405925750732, 0.4532073140144348, 0.3162083923816681, 0.3902202546596527, 0.8607990741729736, 0.08600956946611404, 0.5674425363540649, 0.22309115529060364, 0.17846806347370148, 0.4022504389286041, 0.4877378046512604, 0.35137540102005005, 0.5327576994895935, 0.4564719796180725, 0.10848720371723175, 0.296013742685318, 0.21704864501953125, 0.09896013885736465, 0.43919339776039124, 0.21842239797115326, 0.1880059689283371, 0.8560732007026672, 0.030819155275821686, 0.04255608469247818, 0.0091258455067873, 0.5159698128700256, 0.2884827256202698, 0.11795175075531006, 0.9609854221343994, 0.07743681222200394, 0.25650760531425476, 0.4317423701286316, 0.5028483271598816, 0.961768388748169, 0.5419161915779114, 0.5175866484642029, 0.12869642674922943, 0.6922341585159302, 0.6569043397903442, 0.6214696168899536, 0.6542208790779114, 0.6709629893302917, 0.8015807271003723, 0.5114898085594177, 0.53428053855896, 0.7540146708488464, 0.7086533308029175, 0.027951374650001526, 0.5295676589012146, 0.767207682132721, 0.7418009042739868, 0.6110848784446716, 0.24060651659965515, 0.8638724088668823, 0.6492900848388672, 0.29344478249549866, 0.013095530681312084, 0.20093059539794922, 0.5277747511863708, 0.8065953254699707, 0.5206787586212158, 0.8098454475402832, 0.8556346893310547, 0.7077017426490784, 0.19328372180461884, 0.9321365356445312, 0.15325522422790527, 0.6281988620758057, 0.6466029286384583, 0.21573521196842194, 0.522280216217041, 0.5474708080291748, 0.7003394961357117, 0.0008947967435233295, 0.2928421199321747, 0.870631217956543, 0.3336823582649231, 0.6445037126541138, 0.5372304916381836, 0.15518216788768768, 0.1715388000011444, 0.7324358820915222, 0.23266538977622986, 0.6113508939743042, 0.21436792612075806, 0.979517936706543, 0.17709457874298096, 0.7643069624900818, 0.18055923283100128, 0.692347526550293, 0.7063963413238525, 0.6106894016265869, 0.14025287330150604, 0.22625572979450226, 0.9305298924446106, 0.5800656080245972, 0.8720729351043701, 0.7824316024780273, 0.8865224123001099, 0.30593669414520264, 0.004784966818988323, 0.6337465047836304, 0.15283052623271942, 0.9442787766456604, 0.9809836149215698, 0.5390273332595825, 0.08870459347963333, 0.2819608449935913, 0.48130127787590027, 0.3960670828819275, 0.10808638483285904, 0.23243217170238495, 0.5226538777351379, 0.3757229745388031, 0.03388073295354843, 0.3821798264980316, 0.4382936954498291, 0.7012580037117004, 0.16185297071933746, 0.6928040385246277, 0.3938000202178955, 0.6836247444152832, 0.5157524943351746, 0.9632132053375244, 0.9380356669425964, 0.22813647985458374, 0.7579070329666138]]).astype(np.float32)
print("输入数据:", input_data)

# grpc 创建输入对象
infer_input = grpcclient.InferInput("input__0", input_data.shape, "FP32")
infer_input.set_data_from_numpy(input_data)

# grpc 创建输出请求
outputs = [grpcclient.InferRequestedOutput("output__0")]

# grpc 创建推理请求
response = client.infer(model_name=MODEL_NAME, inputs=[infer_input], outputs=outputs)
print("推理结果:", response.get_response())

# 获取并打印结果
probs = response.as_numpy("output__0")  # shape: [batch, 2]
# labels = response.as_numpy("output__1")

print("输入数据 shape:", input_data.shape)
print("预测概率:\n", probs)
# print("预测标签:\n", labels)
